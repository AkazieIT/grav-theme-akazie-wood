{% set theme_config = attribute(config.themes, config.system.pages.theme) %}
{% set favicon = theme_var('site.favicon') %}
{% set removehead = false %}
{% if page.header.removeheader == true or page.template == 'catfilter' or page.template == 'catpost' %}
{% set removehead = true %}
{% endif %}
<!DOCTYPE html>
<html lang="{{ grav.language.getLanguage ?: 'de' }}">
  <head>
    {% block head %}
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      {{ theme_var('header.javascript')|raw }}
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="apple-mobile-web-app-capable" content="yes"/>
      {% include 'partials/metadata.html.twig' %}
      {% if favicon %}
        {% set favicon_file = (favicon | first).name %}
        <link rel="icon" type="image/png" href="{{ url('theme://custom/favicon/' ~ favicon_file) }}" sizes="32x32"/>
        <link rel="apple-touch-icon" href="{{ url('theme://custom/favicon/' ~ favicon_file) }}">
      {% else %}
        <link rel="icon" type="image/png" href="{{ url('theme://images/favicon.png') }}" sizes="32x32"/>
        <link rel="apple-touch-icon" href="{{ url('theme://images/favicon.png') }}">
      {% endif %}
      <link rel="canonical" href="{{ page.url(true, true) }}"/>
      <title>
        {% if header.title and page.header.markdown.title == false %}{{ header.title|e('html') }}
          |
        {% endif %}{{ site.title|e('html') }}</title>
      {% if theme_var('style.fonts.import') %}

        {% if theme_var ('style.fonts.google') %}
          <link rel="preconnect" href="https://fonts.gstatic.com" />
          <link
            rel="preload"
            as="style"
            href="{{ theme_var('style.fonts.import') }}"
          />
          <link
            rel="stylesheet"
            href="{{ theme_var('style.fonts.import') }}"
            media="print"
            onload="this.media='all'"
          />
          <noscript>
            <link
              rel="stylesheet"
              href="{{ theme_var('style.fonts.import') }}"
            />
          </noscript>
        {% else %}
          <link rel="preload" as="style" href="{{ theme_var('style.fonts.import') }}" onload="this.rel='stylesheet'" />
        {% endif %}
      {% endif %}
      {% if theme_var('style.fonts.customhtml') %}
        {{ theme_var('style.fonts.customhtml') }}
      {% endif %}
      {% block assets deferred %}
        {{ assets.css()|raw }}
        {{ assets.js()|raw }}
      {% endblock %}
      {% if theme_var('site.slideimagesin') %}
      <style>
      body {
      overflow-x:hidden;
      }
      .hiddensli {
      display:none;
      }
      .slide-in {
          opacity:0 !important;
          transition:1.5s;
        }
        .active {
          opacity:1 !important;
           transition: all 1.5s;
          -webkit-transition: all 1.5s;
          transform: translateX(0%) !important;

        }
        .align-left {
     transform: translateX(-110%);
 }

 .align-right {
   transform: translateX(110%);
 }
 </style>

        {% endif %}

      {% if page.header.masonry == 1 %}
      {% do assets.addJs('theme://build/js/akazie-wood.masonry.min.js') %}


      {{ masonry.js()|raw }}
        <style>
        .grid-sizer,
        .grid-item {
          width: 33.3%;
        }
        article {
          width: 33.3%;
          padding: {{ theme_var('header.masonryp') }};
        }
        article.a-width2 { width:  66.6%; }
        article.a-width3 { width:  99.9%; }
        @media (max-width: 869px) {
          article {
            width: 100%;
            padding: 10px;
          }
          article.a-width2 { width:  100%; }
          article.a-width3 { width:  100%; }
        }
        </style>
      {% endif %}
      {% include 'partials/custom-css.html.twig' %}


    {% endblock head %}

  </head>
  <body class="{{ page.header.body_classes }}{% if theme_var('nav.expanded') == '1' %} navexpanded{% endif %} page-{{ page.slug }}">
  {% if theme_var('header.kundencode') == 'stkh' %}
  <div class="fullbgstkh"></div>
  {% endif %}
    {% if config.plugins.langswitcher.enabled %}
      {% include 'partials/langswitcher.html.twig' %}
    {% endif %}

    {% if theme_var('site.parallax') == 0 %}
      <div class="wrapper">
      {% else %}
        <div class="wrapper" style="background-image: url('{{ page.header.image  ? page.media[page.header.image].url : theme_url ~ '/images/home.jpg' }}')">
        {% endif %}
        {% block header %}
          {% include 'partials/header.html.twig' %}
        {% endblock %}

        {% if page.header.kundencode != 'immosit' and page.header.kundencode != 'immositweb'  %}

          {% if page.template == 'home' %}
            {% set image = page.header.image %}
            {% if theme_var('site.parallax') == 0 %}


              <div
                class="screen-image screen-fullscreen{% if removehead == true %} removeheader{% endif %}{% if page.template == 'home' and page.header.slideshow %} bgslide{% endif %}"
                {% if removehead != true %}
                style="background-image: url('{{ image ? page.media[image].url : theme_url ~ '/images/home.jpg' }}')"
                {% endif %}>
              {% else %}
                <div class="screen-image screen-fullscreen">
                {% endif %}
                <div
                  class="image-caption color-new-line  {% if page.header.markdown.newlineoncolorchangemobile %}color-new-line-mobile{% endif %}{% if page.header.claimswitch == true %} claim{% endif %}{% if removehead == true %} removeheader{% endif %}">
                  {% if page.header.markdown.title %}
                    {{ page.header.title | markdown }}
                  {% else %}
                    {% if page.header.claimswitch == false %}
                      <h1 style="word-wrap: break-word">{{ page.header.title }}</h1>
                    {% else %}
                      {% if page.header.claimasmarkdown == false %}

                        {% if theme_var('header.properh') == 0 %}
                        <h3 class="claim">{{ page.header.claim | nl2br }}</h3>
                        {% else %}
                        <div class="claim">{{ page.header.claim | nl2br }}</div>
                        {% endif %}

                      {% else %}
                        <div class="claim">{{ page.header.claim | markdown }}</div>
                      {% endif %}
                    {% endif %}

                  {% endif %}
                  <p>{{ page.header.text }}</p>
                </div>
              </div>

            {% else %}
              {% set image = page.header.image %}
              {% if theme_var('site.parallax') == 0 %}
            <div class="screen-image screen-top{% if removehead == true %} removeheader{% endif %}"
             {% if removehead != true %}
                style="background-image: url('{{ image  ? page.media[image].url : theme_url ~ '/images/home.jpg' }}')" {% endif %}> {% else %}
                  <div class="screen-image screen-top">
                  {% endif %}

                <div class="image-caption{% if page.header.claimswitch == true %} claim{% endif %}{% if removehead == true %} removeheader{% endif %}">

                  {% if theme_var('header.kundencode') != 'immosit' and theme_var('header.kundencode') != 'immositweb' %}

                  {% if page.header.claimswitch == false %}
                    <h1 style="word-wrap: break-word">{{ page.header.title }}</h1>
                  {% else %}
                    {% if page.header.claimasmarkdown == false %}
                      {% if theme_var('header.properh') == 0 %}
                      <h3 class="claim">{{ page.header.claim | nl2br }}</h3>
                      {% else %}
                      <div class="claim">{{ page.header.claim | nl2br }}</div>
                      {% endif %}


                    {% else %}
                      <div class="claim">{{ page.header.claim | markdown }}</div>
                    {% endif %}
                  {% endif %}

                  {% else %}




                  {% endif %}
                  </div>
                </div>
              {% endif %}

            {% endif %}

            {% block main %}
              <main class="site-content">
                {% if page.header.kundencode == 'immosit' %}
                  <div class="bookinghover">
                    <form action="/wohnungen">
                      <ul>
                        <li>
                          <input type="radio" id="radioApple" name="betten" value="2 Betten">
                          <label for="radioApple">
                            <div>
                              <strong class="bigger">2</strong>
                              Betten</div>
                          </label>
                          <input type="radio" id="radioBanana" name="betten" value="3 Betten">
                          <label for="radioBanana">
                            <div>
                              <strong class="bigger">3</strong>
                              Betten</div>
                          </label>
                          <input type="radio" id="radioOrange" name="betten" value="ab 4 Betten">
                          <label for="radioOrange">
                            <div>
                              <span style="font-size:16px;">ab</span>
                              <strong class="bigger">4</strong>
                              Betten</div>
                          </label>
                        </li>

                        <li>
                          <input type="checkbox" id="myCheckbox1" name="wlan" value="ja"/>
                          <label for="myCheckbox1">
                            <img src="{{ url( 'theme://custom/logo/wlan-white.svg') }}">
                            <div>WLAN</div>
                          </label>
                        </li>
                        <li>
                          <input type="checkbox" id="myCheckbox2" name="fahrstuhl" value="ja"/>
                          <label for="myCheckbox2">
                            <img src="{{ url( 'theme://custom/logo/sort-circle-solid-white.svg') }}">
                            <div>Fahrstuhl</div>
                          </label>
                        </li>
                        <li>
                          <input type="checkbox" id="myCheckbox3" name="haustiere" value="ja"/>
                          <label for="myCheckbox3">
                            <img src="{{ url( 'theme://custom/logo/paw-solid-white.svg') }}">
                            <div>Haustiere</div>
                          </label>
                        </li>
                        {#
                      <li>
                        <input type="checkbox" id="myCheckbox4"  name="parking" value="ja" />
                        <label for="myCheckbox4">
                          <img src="{{ url( 'theme://custom/logo/parking-solid-white.svg') }}"><span>Fahrstuhl</span>
                        </label>
                      </li>
                      #}
                        <li>
                          <input type="submit" value="Suchen">
                        </li>
                      </ul>
                    </div>
                    <div class="screen-image screen-fullscreen">
                      <section class="page section-modular immositstart">
                        <div class="row">
                          <article class="modular section-text col-12 col-md-6">
                            <h2 class="heading">{{page.header.title | raw}}</h2>
                            <div class="markdown ">
                              {{page.header.text | markdown}}
                              <a class="bookinghovermobile linksbutton" href="{{ base_url_absolute  ~ '/wohnungen' }}">
                                Ferienwohnung buchen
                              </a>
                            </div>
                          </article>
                          <article class="modular section-image col-12 col-md-6">
                            <div class="media-container ">
                              {% set image = page.header.image %}
                              <img class="media startimg" title="{{ page.header.title }}" alt="Immosit" src="{{ page.media[image].cropZoom(500,500).url }}"/>

                            </div>
                          </article>
                        </div>
                      </section>
                    </div>

                  {% elseif page.header.kundencode == 'immositweb' %}
                  <div class="bookinghover">
                      <ul>
                        <li>
                          <a href="/wohnungen?verkauf=ja#catcont" class="kauf"><div class="bookspan">Kaufen</div></a>


                        <li>
                          <a href="/wohnungen?vermietung=ja#catcont" class="miet"><div class="bookspan">Mieten</div></a>


                        </li>
                        <li>
                          <a href="https://fewolenk.ch" target="_blank" class="fewo"><div class="bookspan">Ferienwohnung</div></a>

                        </li>



                      </ul>
                    </div>
                    <div class="screen-image screen-fullscreen">
                      <section class="page section-modular immositstart">
                        <div class="row">
                          <article class="modular section-text col-12 col-md-5">
                          <h2>{{page.header.title | raw}}</h2>
                          <div class="markdown headertext">
                            {{page.header.text | markdown}}
                            <a class="bookinghovermobile linksbutton" href="{{ base_url_absolute  ~ '/wohnungen' }}">
                              Immobilien ansehen
                            </a>
                          </div>
                            <div class="media-container startimgtwo">
                              {% set imagetwo = page.header.imagetwo %}
                              <img class="media startimg startimgtwo" title="{{ page.header.title }}" alt="Immosit" src="{{ page.media[imagetwo].cropZoom(750,600).url }}"/>

                            </div>
                          </article>
                          <article class="modular section-image col-12 col-md-7 startimgone">
                            <div class="media-container ">
                              {% set image = page.header.image %}
                              <img class="media startimg" title="{{ page.header.title }}" alt="Immosit" src="{{ page.media[image].cropZoom(1000,1000).url }}"/>

                            </div>
                          </article>
                        </div>
                      </section>
                    </div>
                  {% endif %}
                  {% block content %}{% endblock %}
                </main>
              {% endblock %}

              {% block footer %}
                {% include 'partials/footer.html.twig' %}
              {% endblock %}
            </div>
            {% if theme_var('site.slideimagesin') %}
            <script>
            function debounce(func, wait, immediate) {
              var timeout;
              return function () {
                var context = this,args = arguments;
                var later = function () {
                  timeout = null;
                  if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
              };
            };

            const sliderImages = document.querySelectorAll('.slide-in');

            function checkSlide(e) {

              // loop over every image
              // figure out where it needs to be shown
              // at least 50% of its height

              var scrollposy = window.scrollY;
              sliderImages.forEach(sliderImage => {
                //half way through images
                const slideInAt = window.scrollY + window.innerHeight - sliderImage.height / 2;

                var bodyRect = document.body.getBoundingClientRect(),
                    elemRect = sliderImage.getBoundingClientRect(),
                    offset   = elemRect.top - bodyRect.top;


                // bottom of the image
                const imageBottom = offset + sliderImage.offsetHeight;
                // half way in the images
                const isHalfShown = slideInAt > offset;

                const isNoScrolledPast = window.scrollY < imageBottom;

                if (isHalfShown && isNoScrolledPast) {
                  sliderImage.classList.add('active');
                } else {
                  sliderImage.classList.remove('active');
                }
              });


            }

            window.addEventListener('scroll', debounce(checkSlide));
            </script>
            {% endif %}

            {% for img in page.media %}
            <div class="hiddensli">{{ img.url }}</div>

            {% endfor %}

            {% if page.template == 'home' and page.header.slideshow %}
            <script>
            easy_background(".bgslide",

              {
                slide: [],

                delay: []
              }


            );
            function easy_background(selector, sld_args) {

              function empty_img(x) {
                if (x) {
                  return "<img src='" + x + "'>";
                } else {
                  return "";
                }
              }

              //use object same as arrays in php {nameofindex:variable} inside object you can use arrays [value1,val2] (variable in object can be as array
              //var sld_args={i:["img/555.jpg","img/44.jpg","img/33.jpg","img/22.jpg","img/11.jpg","img/1.jpg","img/2.jpg","img/3.jpg","img/4.jpg","img/5.jpg"],d:[3000,3000,3000,3000,3000] };

              //if delay is empty or forgotten then use this default value
              var def_del = 3000;

              var p = document.createElement("div");
              p.innerHTML = " ";
              p.classList.add("easy_slider");

              document.body.insertBefore(p, document.body.firstChild);
              //switch all values in object -- objectname.index in you case sld_args is object and i is index of array which keep images (i). We use this function for fill div with img tags
              //and for insert delays into empty or forgotten places in object

              document.querySelectorAll('.hiddensli').forEach(function(el) {
                sld_args.slide.push(el.textContent)
                sld_args.delay.push(5000)
              })

              //add various style on selector
              document.querySelector(".easy_slider").style.display = "none";


              //add various style on selector
              document.querySelector(selector).style.backgroundSize = "contain";
              document.querySelector(selector).style.backgroundRepeat = "no-repeat";
              document.querySelector(selector).style.backgroundPosition = "center center";


              setTimeout(function() {
                //add various style on selector
                if (typeof sld_args.transition_timing === 'undefined') {
                  sld_args.transition_timing = "ease-in";
                }
                if (typeof sld_args.transition_duration === 'undefined') {
                  sld_args.transition_duration = 1000;
                }
                var transition = "all " + sld_args.transition_duration + 'ms ' + sld_args.transition_timing;
                document.querySelector(selector).style.WebkitTransition = transition;
                document.querySelector(selector).style.MozTransition = transition;
                document.querySelector(selector).style.MsTransition = transition;
                document.querySelector(selector).style.OTransition = transition;
                document.querySelector(selector).style.transition = transition;
              }, 100);


              //this n is number of row  in object - if first row one function if more than 1 then other
              var n = 1;
              //li collection previous delays from previous slides
              var li = 0;

              function slider() {
                //switching all images one by one
                sld_args.slide.forEach(function(vvv, iii) {
                  //here go all slides except first
                  if (n > 1) {
                    //set delay from collected number from previous slides
                    var delay = li;
                    setTimeout(function() {

                      document.querySelector(selector).style.backgroundImage = "url('" + vvv + "')";

                    }, delay); // >1
                    //collecting delays from curent
                    li = li + sld_args.delay[iii];

                  } else { //this function for only  first slide

                    //next row
                    n++;
                    //collect delay first time
                    li = sld_args.delay[iii];

                    document.querySelector(selector).style.backgroundImage = "url('" + vvv + "')";

                  }

                });

              };

              slider();

              setInterval(function() { // REPEAT

                slider();
                //here used length of array of delays in object instead you tot_time variable
              }, sld_args.delay.length);

            }
            </script>


            {% endif %}
            {% if theme_var('map.apikey') and theme_var('map.type') == 'google' %}
              {%  include 'partials/map-google-js.html.twig' %}
            {% elseif theme_var('map.type') == 'osm' %}
              {%  include 'partials/map-osm-js.html.twig' %}
            {% endif %}
            {% block bottom %}
              {{ assets.js('bottom')|raw }}
              {{ theme_var('footer.javascript.code')|raw }}
              {% if page.header.masonry == 1 %}
              <script>
              var grid = document.querySelector('.masonryrow');
              imagesLoaded( document.querySelector('.masonryrow'), function( instance ) {
                var msnry = new Masonry( grid, {
                  itemSelector: 'article',
                  columnWidth: '.grid-sizer',
                  percentPosition: true
                });
              });
              </script>
            {% endif %}
            {% endblock %}
          </body>
        </html>
