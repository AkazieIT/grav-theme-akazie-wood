{% set theme_config = attribute(config.themes, config.system.pages.theme) %}
{% set favicon = theme_var('header.favicon') %}
<!DOCTYPE html>
<html lang="{{ grav.language.getLanguage ?: 'de' }}">
  <head>
    {% block head %}
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="apple-mobile-web-app-capable" content="yes" />
      {% include 'partials/metadata.html.twig' %}
      {% if favicon %}
        {% set favicon_file = (favicon|first).name %}
        <link rel="icon" type="image/png" href="{{ url('theme://images/favicon/' ~ favicon_file) }}" sizes="32X32" />
        <link rel="apple-touch-icon" href="{{ url('theme://images/favicon/' ~ favicon_file) }}">
      {% else %}
        <link rel="icon" type="image/png" href="{{ url('theme://images/favicon.png') }}" sizes="32X32" />
        <link rel="apple-touch-icon" href="{{ url('theme://images/favicon.png') }}">
      {% endif %}
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="canonical" href="{{ page.url(true, true) }}" />
      <title>{% if header.title %}{{ header.title|e('html') }} | {% endif %}{{ site.title|e('html') }}</title>

      {% block assets deferred %}
        {{ assets.css()|raw }}
        {{ assets.js()|raw }}
      {% endblock %}

    {% endblock head %}

  </head>
  <body class="{{ page.header.body_classes }}">
    <div class="wrapper">
      {% block header %}
        {% include 'partials/header.html.twig' %}
      {% endblock %}


      {% if page.template == 'home' %}
        {% set image = page.header.image %}
        <div class="screen-image screen-fullscreen" style="background-image: url('{{ image ? page.media[image].cropZoom(1920,1080).url : theme_url ~ '/images/home.jpg' }}')">
          <div class="image-caption">
            <h1>{{ page.header.title }}</h1>
            <p>{{ page.header.text }}</p>
          </div>
        </div>
      {% else %}
        {% set image = page.header.image %}
        <div class="screen-image screen-top" style="background-image: url('{{ image  ? page.media[image].cropZoom(1920,450).url : theme_url ~ '/images/home.jpg' }}')">
          <div class="image-caption">
            <h1>{{ page.header.title }}</h1>
          </div>
        </div>
      {% endif %}


      {% block main %}
        <main class="site-content">
          {% block content %}{% endblock %}
        </main>
      {% endblock %}

      {% block footer %}
        {%  include 'partials/footer.html.twig' %}
      {% endblock %}
    </div>

    <script>
      function drawMaps(){
        var map = [],
            marker = [],
            infowindow = [],
            style = [];
        $('.js-map').each(function( i ){
          if(this.getAttribute('map-style')){
            style = JSON.parse(this.getAttribute('map-style'));
          }

          var cords = {lat: Number(this.getAttribute('map-lat')), lng: Number(this.getAttribute('map-lon'))};

          mapOptions = {
            zoom: Number(this.getAttribute('map-zoom')),
            center: cords,
            disableDefaultUI: Boolean(this.getAttribute('map-controls')),
            styles: style
          };

          map[i] = new google.maps.Map(this, mapOptions);
          marker[i] = new google.maps.Marker({
            position: cords,
            map: map[i],
            title: String(this.getAttribute('map-markertitle'))
          });
          infowindow[i] = new google.maps.InfoWindow({
            content: this.getAttribute('map-infowindow')
          });
          marker[i].addListener('click', function() {
            infowindow[i].open(map[i], marker[i]);
          });

        });
      }
    </script>

    {% block javascripts %}
      {% do assets.addJs('https://maps.googleapis.com/maps/api/js?key=AIzaSyD7ksDkDvbaVFeL-GxEIAsuIYPQGVRXF6g&callback=drawMaps',{'priority':0, 'group':'bottom'}) %}
    {% endblock %}
    {% block bottom %}
      {{ assets.js('bottom')|raw }}
    {% endblock %}


  </body>
</html>
